# 4μ£Όμ°¨

# 1. μ ν¨μ„± κ²€μ‚¬λ€?

## a. μ ν¨μ„± κ²€μ‚¬κ°€ λ¬΄μ—‡μΌκΉμ”?

**μ ν¨μ„± κ²€μ‚¬**λ€ μ™Έλ¶€ **μ”μ²­**(Request)λ΅λ¶€ν„° μ „λ‹¬λ λ°μ΄ν„°λ“¤μ΄ ν•μ‹μ— λ”°λΌ μ μ „λ‹¬μ΄ λμ—λ”μ§€, μμƒλλ” κ°’λ“¤μ΄ λ“¤μ–΄μ™”λ”μ§€ μ¦‰, **μ ν¨ν• λ°μ΄ν„°μΈμ§€ ν™•μΈν•λ” μ μ°¨**μ…λ‹λ‹¤.

## b. μ ν¨μ„± κ²€μ‚¬λ¥Ό μ™ ν•΄μ•Όν• κΉμ”?

κ·Έλ ‡λ‹¤λ©΄, μ΄ μ ν¨μ„± κ²€μ‚¬λ¥Ό μ™ μ§„ν–‰ν•΄μ•Ό ν• κΉμ”? μ—¬λ¬κ°€μ§€ μ΄μ κ°€ μκ² μ§€λ§, μ €λ” μ•„λμ²λΌ ν¬κ² λ‘ μ΄μ κ°€ μλ‹¤κ³  μƒκ°ν•λ”λ°μ”.

- **μ„λ²„ μ¥μ•  μµμ†ν™”**
- **λ°μ΄ν„°λ² μ΄μ¤ λ¬΄κ²°μ„± μ μ§€**

### **π€**Β μ„λ²„ μ¥μ•  μµμ†ν™”

λ³΄ν†µ κµ¬κΈ€, λ„¤μ΄λ²„μ™€ κ°™μ€ λ€ν• μ‚¬μ΄νΈλ“¤μ„ μ„ν•‘ν•  λ•, μ„λ²„κ°€ μ•„μ λ‹¤μ΄λμ–΄μ„ μ ‘μ†μ΄ μ•λμ—λ κ²½ν—μ΄ μμΌμ‹ κ°€μ”? μ €λ” νΈλν”½μ΄ λ°λ ¤μ„ λ§λΉ„κ°€ λ κ²½μ°λ” μμ—λ”λ°, μ„λ²„κ°€ μ™„μ „ν μ£½μ–΄λ²„λ¦° κ²½μ°λ” μ λ» λ³Έ κ²ƒ κ°™μµλ‹λ‹¤.              

μ„λ²„μ—μ„ μ—λ¬κ°€ μƒκΈ°λ©΄, ν•΄λ‹Ή λ¶€λ¶„κ³Ό μ—°κ΄€λ λ¶€λ¶„λ§ μμ •ν•΄μ„ λ‹¤μ‹ λ¦΄λ¦¬μ¦ν•λ©΄ λμ§€λ§, μ„λ²„κ°€ μ•„μ λ‹¤μ΄λλ‹¤λ©΄ λ‹¤λ¥Έ μ„λΉ„μ¤λ“¤μ—λ„ μ§€μ¥μ΄ κ°€λ‹ κ½¤λ‚ ν° λ¬Έμ κ°€ λ°μƒν•  κ²λ‹λ‹¤. 

μ΄λ¬ν• μΈ΅λ©΄μ—μ„ μ ν¨μ„± κ²€μ‚¬λ„ μ„λ²„μ— λ¬Έμ κ°€ μƒκΈ°μ§€ μ•κ² **μ„ν—μ„±μ„ μµμ†ν™”ν•λ” λ°©λ²•** μ¤‘μ— ν•λ‚λΌκ³  μƒκ°ν•©λ‹λ‹¤. **ν•μ‹μ— λ§μ§€ μ•λ” λ°μ΄ν„°κ°€ λ“¤μ–΄μ¤λ©΄, μ΄ λ°μ΄ν„°λ” μ„λ²„μ— λ€ν• μ¥μ• λ¥Ό μΌμΌν‚¬ ν™•λ¥ μ΄ λ†’μΌλ‹ μ‚¬μ „μ— μ²λ¦¬**ν•΄μ£Όλ” λλ‚μ΄μ£ . 

### **π€**Β λ°μ΄ν„°λ² μ΄μ¤ λ¬΄κ²°μ„± μ μ§€

DBμ λ¬΄κ²°μ„±μ΄λΌκ³  ν•λ©΄, λ°μ΄ν„°λ² μ΄μ¤μ—λ” **κ²°ν•¨μ΄ μ—†λ” λ°μ΄ν„°κ°€ λ“¤μ–΄κ°€μ•Ό ν•λ‹¤λ” μ›μΉ™**μ„ μλ―Έν•©λ‹λ‹¤. μ΄ λ¬΄κ²°μ„±μ„ μ μ§€ν•λ©°, μ¬λ°”λ¥Έ λ°μ΄ν„°λ¥Ό μ°Έμ΅°ν•κ³  μ‚¬μ©μμ—κ² μ „λ‹¬ν•λ” κ²ƒμ΄ μ¤‘μ”ν• μ›μΉ™μ…λ‹λ‹¤. 

## c. μ„λΉ„μ¤μ—μ„ μ ν¨μ„± κ²€μ‚¬

μ—¬λ¬λ¶„μ€ ν”„λ΅ νΈμ•¤λ“μ™€ λ°±μ•¤λ“ μ¤‘ μ–΄λ””μ—μ„ μ ν¨μ„± κ²€μ‚¬λ¥Ό ν•΄μ•Όν•λ‹¤κ³  μƒκ°ν•μ‹λ‚μ”? κ°λ°μ„ μ‹μ‘ν•μ§€ μ–Όλ§ λμ§€ μ•μ•μ„ λ•μ—λ” ***λ°μ΄ν„°λ¥Ό μ§μ ‘ λ‹¤λ£¨κ³  κΉλ³΄λ” κ³³μ€ μ„λ²„λ‹κΉ, μ„λ²„λ§ ν•΄μ£Όλ©΄ λλ”κ±° μ•„λ‹μ•Ό?*** λΌκ³  μƒκ°ν–μ§€λ§, κ΄€μ μ„ μ΅°κΈ λ” λ„“κ² λ³΄λ‹ **ν΄λΌ, μ„λ²„ λ‘ λ‹¤ ν•΄μ£Όλ” κ² λ§λ‹¤**κ³  μƒκ°μ΄ λ“¤μ—μµλ‹λ‹¤. 

λ§μ•½, μ„λ²„μ—μ„λ§ μ ν¨μ„± κ²€μ‚¬λ¥Ό μ§„ν–‰ν•λ©΄ **ν΄λΌμ΄μ–ΈνΈ μ½μ—μ„ ν•„ν„°λ§λμ§€ μ•μ€ μ”μ²­λ“¤μ΄ λ§κµ¬μ΅μ΄λ΅ λ“¤μ–΄μ¤κΈ° λ•λ¬Έμ—, μ„λ²„μ— λ€ν• λ¶€ν•κ°€ μ»¤μ§€κ² λ  κ²ƒ**μ…λ‹λ‹¤.

λ°λ€λ΅ ν΄λΌμ΄μ–ΈνΈμ—μ„λ§ ν•λ©΄, λ¬Όλ΅  μ¤ν¬λ¦½νΈλ¥Ό κ±°μΉκ³  λ“¤μ–΄μ¤λ” μ”μ²­λ“¤μ€ ν•„ν„°λ§μ΄ λκ² μ§€λ§ **μ¤ν¬λ¦½νΈλ¥Ό κ±°μΉμ§€ μ•κ³  μ§μ ‘ μ”μ²­μ„ λ‚ λ¦¬λ” κ²½μ°**(ν¬μ¤νΈλ§¨, μ¤μ›¨κ±°λ§ ν•΄λ„ μ„λ²„λ΅ μ§μ ‘ μ”μ²­μ„ λ‚ λ¦¬μ£ ) **ν΄λΌμ΄μ–ΈνΈ μΈ΅μ—μ„ μ”μ²­μ„ ν•„ν„°λ§ν•  μ μλ” λ°©λ²•μ΄ μ—†**κ³  μ„λ²„λ” μ§κ²©νƒ„μ„ λ§κ² μ£ . 

β—οΈλ”°λΌμ„! **μ ν¨μ„± κ²€μ‚¬λ” ν”„λ΅ νΈ, λ°± λ‘ λ‹¤** ν•΄μ£Όμ–΄μ•Όν•©λ‹λ‹¤. 

# 2. μ¤ν”„λ§μ—μ„μ μ ν¨μ„± κ²€μ‚¬

## a. Spring Bean Validation

**Bean Validation**μ΄λ€, **μ–΄λ…Έν…μ΄μ…(@)**μ„ ν†µν•΄ μ μ•½ μ΅°κ±΄μ„ μ„¤μ •ν•μ—¬ κ°„νΈν•κ² λ°μ΄ν„°λ¥Ό κ²€μ¦ν•  μ μλ„λ΅ λ„μ™€μ£Όλ” APIμ— λ€ν• μ •μλ¥Ό μλ―Έν•©λ‹λ‹¤. 

## b. @Validμ™€ @Validated

### @Valid

`@Valid`λ” JSR ν‘μ¤€ μ¤ν©μΌλ΅ **Bean Validator**λ¥Ό ν†µν•΄ κ°μ²΄λ¥Ό λΉ„λ΅―ν• λ°μ΄ν„°μ— λ€ν• μ μ•½ μ΅°κ±΄μ„ κ²€μ‚¬ν•λΌκ³  **μ§€μ‹ν•λ” μ–΄λ…Έν…μ΄μ…**μ…λ‹λ‹¤. μ‹¤μ λ΅λ” **`LocalValidatorFactoryBean`**μ΄ κ²€μ‚¬λ¥Ό μν–‰ν•κ² λλ”λ°, μ΄ μΉκµ¬λ” 

```java
implementation 'org-springframework.boot:spring-boot-starter-validation'
```

μ„ μμ΅΄μ„±μ„ μ¶”κ°€ν•΄μ£Όκ² λλ©΄, μλ™μΌλ΅ λ“±λ΅λμ–΄ μ‚¬μ©ν•  μ μμµλ‹λ‹¤.

### @Validμ λ™μ‘ κ³Όμ •

![image1.png](image1.png)

λ¨Όμ €, ν΄λΌμ΄μ–ΈνΈμ μ”μ²­μ΄ **`Dispatcher Servlet`**(ν”„λ΅ νΈ μ»¨νΈλ΅¤λ¬)μ— λ„μ°©ν•κ² λλ©΄, Dispatcher Servletμ **Handler Adapterμ HandlerMappingμ„ ν†µν•΄ μ μ ν• μ»¨νΈλ΅¤λ¬**λ¥Ό μ°Ύμµλ‹λ‹¤.

μ»¨νΈλ΅¤λ¬λ¥Ό μ°Ύμ•λ‹¤λ©΄ ν•΄λ‹Ή μ”μ²­μ„ μ²λ¦¬ν•  λ©”μ†λ“μ™€ λ°”μΈλ”©ν•λ” κ³Όμ •μ„ κ±°μΉκ² λλ”λ°, μ΄ κ³Όμ •μ—μ„ μ”μ²­μ— ν¬ν•¨λ λ°μ΄ν„°κ°€ νλΌλ―Έν„°μ— λ°”μΈλ”©λκΈ° μ „! **Validλ΅ μ‹μ‘**ν•λ” μ–΄λ…Έν…μ΄μ…μ΄ μ•μ— λ¶™μ–΄ μλ‹¤λ©΄, μ ν¨μ„± κ²€μ‚¬λ¥Ό μν–‰ν•κ² λ©λ‹λ‹¤. ~~(**@ValidTodoμ™€ κ°™μ΄ μ ν¨μ„± κ²€μ‚¬λ¥Ό μ»¤μ¤ν…€ν•΄μ„ μ‚¬μ©ν•  μ μλ„λ΅ Validλ΅ μ‹μ‘ν•λ” μ–΄λ…Έν…μ΄μ…μ„ λ€μƒμΌλ΅ μ ν¨μ„± κ²€μ‚¬λ¥Ό μ§„ν–‰ν•κ² λ©λ‹λ‹¤.)**~~

λ§μ•½ μ ν¨μ„± κ²€μ‚¬λ¥Ό μ λ€λ΅ ν†µκ³Όν•μ§€ λ»ν–λ‹¤λ©΄, **`MethodArgumentNotValidException`**κ°€ λ°μƒν•κ² λ©λ‹λ‹¤. 

### @Validatedμ™€ λ™μ‘ κ³Όμ •

@Validλ¥Ό λ‹¨λ…μΌλ΅, μ§μ ‘μ μΌλ΅ μ‚¬μ©ν•  μ μλ” κ³„μΈµμ€ **μ»¨νΈλ΅¤λ¬ κ³„μΈµ**μ…λ‹λ‹¤. λ”°λΌμ„, μ»¨νΈλ΅¤λ¬ κ³„μΈµμ΄ μ•„λ‹ κ³³μ—μ„ μ‚¬μ©ν•κΈ° μ„ν•΄μ„λ” **@Validated μ–΄λ…Έν…μ΄μ…μ„ ν™μ©**ν•΄μ•Όν•©λ‹λ‹¤. 

~~μ»¨νΈλ΅¤λ¬ κ³„μΈµμ—μ„λ„ @QueryParamμ΄λ‚ @PathVariableμ— λ€ν•΄ μ ν¨μ„± κ²€μ‚¬λ¥Ό μ§„ν–‰ν•λ ¤λ©΄, @Validatedλ¥Ό ν™μ©ν•΄μ•Όν•λ”λ°, μ¶”ν›„μ— μ΄μ–΄μ„ μ„¤λ…ν•κ² μµλ‹λ‹¤.~~

`@Validated`λ” **μ¤ν”„λ§ ν”„λ μ„μ›ν¬μ—μ„ μ κ³µν•λ” μ–΄λ…Έν…μ΄μ…**μΌλ΅, **AOP** κΈ°λ°μΌλ΅ λ™μ‘ν•©λ‹λ‹¤. λ§μ•½, ν΄λμ¤ λλ°Έμ— **@Validated**μ„ μ μ©ν•λ©΄, μ ν¨μ„± κ²€μ‚¬λ¥Ό μ„ν• AOP μΈν„°μƒ™ν„°μΈ `MethodValidationInterceptor`κ°€ λ“±λ΅λ©λ‹λ‹¤. κ·Έλ¦¬κ³  ν•΄λ‹Ή **ν΄λμ¤ λ‚΄μ λ©”μ†λ“κ°€ νΈμ¶λλ©΄, μΈν„°μƒ™ν„°κ°€ μ”μ²­μ„ κ°€μ Έμ™€ μ ν¨μ„± κ²€μ‚¬λ¥Ό μ‹¤ν–‰**ν•κ² λ©λ‹λ‹¤. 

λ”°λΌμ„, μ»¨νΈλ΅¤λ¬κ°€ μ•„λ‹ λ μ΄μ–΄(μλ¥Ό λ“¤μ–΄ μ„λΉ„μ¤)μ—μ„ μ ν¨μ„± κ²€μ‚¬λ¥Ό μ§„ν–‰ν•λ ¤λ©΄, ν΄λμ¤ λ λ²¨μ— `@Validated`, λ©”μ†λ“ λ‚΄μ νλΌλ―Έν„°μ— `@Valid`λ¥Ό μ μ©ν•μ—¬ μν–‰ν•  μ μμµλ‹λ‹¤. μμ‹λ” μ•„λμ™€ κ°™μµλ‹λ‹¤.

```java
@Service
@Validated
@RequiredArgsConstructor
public class TravelogService {
	
    public TravelogsResponseDto searchTravelogs(@Valid String mainPlace, String sortBy) {
        List<TravelogEntity> travelogs;
        if ("likes".equalsIgnoreCase(sortBy)) {
            travelogs = travelogRepository.findAllByMainPlaceContainingOrderByLikesDesc(mainPlace)
                    .orElse(List.of());
        } else {
            travelogs = travelogRepository.findAllByMainPlaceContainingOrderByCreatedAtDesc(mainPlace)
                    .orElse(List.of());
        }

        List<TravelogSummaryDto> travelogSummarys = travelogs.stream()
                .map(this::convertToSummaryDto)
                .collect(Collectors.toList());

        return new TravelogsResponseDto(travelogSummarys, travelogSummarys.size());
    }
}
```

`@Validated`λ” AOPλ¥Ό κΈ°λ°μΌλ΅ λ™μ‘ν•κΈ° λ•λ¬Έμ— **Spring BeanμΌλ΅ λ“±λ΅λμ–΄ μλ‹¤λ©΄, μ μ©μ΄ κ°€λ¥**ν•©λ‹λ‹¤. 

### @Validatedμ™€ @RequestParam

`@RequestParam`μ΄ μ μ©λ νλΌλ―Έν„°μ— μ ν¨μ„± κ²€μ‚¬λ¥Ό μν–‰ν•κ³  μ‹¶λ‹¤λ©΄, μ•„λμ²λΌ μ»¨νΈλ΅¤λ¬ λ μ΄μ–΄μ— **@Validatedλ¥Ό μ μ©**ν•΄μ•Ό ν•©λ‹λ‹¤.

```java
@RestController
@RequestMapping("/api/users")
@Validated  // μ»¨νΈλ΅¤λ¬μ— @Validated μ μ©
public class UserController {

   @GetMapping("/users")
   public ResponseEntity<List<User>> searchUsers(
       @RequestParam 
       @NotBlank(message = "κ²€μƒ‰μ–΄λ” ν•„μμ…λ‹λ‹¤") // μ ν¨μ„± κ²€μ‚¬ μ΅°κ±΄ 
       @Size(min = 2, max = 10, message = "κ²€μƒ‰μ–΄λ” 2-10μ μ‚¬μ΄μ—¬μ•Ό ν•©λ‹λ‹¤")
       String keyword,

       @RequestParam
       @Min(value = 1, message = "νμ΄μ§€ λ²νΈλ” 1 μ΄μƒμ΄μ–΄μ•Ό ν•©λ‹λ‹¤")
       @Max(value = 100, message = "νμ΄μ§€ λ²νΈλ” 100 μ΄ν•μ—¬μ•Ό ν•©λ‹λ‹¤") 
       Integer page
   ) {
       List<User> users = userService.searchUsers(keyword, page);
       return ResponseEntity.ok(users);
   }

```

## c. μ ν¨μ„± κ²€μ‚¬ μ–΄λ…Έν…μ΄μ…

| Annotation | Description |
| --- | --- |
| `@Size` | **λ¬Έμμ—΄μ κΈΈμ΄ κ²€μ‚¬** |
| `@Notnull` | **null κ²€μ‚¬** |
| `@NotEmpty`  | **null, β€β€ κ²€μ‚¬** |
| `@NotBlank` | **null, β€β€, β€ β€ κ²€μ‚¬** |
| `@Past(OrPresent)` | **κ³Όκ±° λ‚ μ§λ§ ν—μ©(νΉμ€ ν„μ¬λ„ ν—μ©)** |
| `@Future(OrPresent)` | **λ―Έλ λ‚ μ§λ§ ν—μ©(νΉμ€ ν„μ¬λ„ ν—μ©)** |
| `@Pattern` | **μ •κ·μ‹μ„ ν™μ©ν•μ—¬ κ²€μ‚¬** |
| `@Min/@Max` | **μµλ€, μµμ† κ²€μ‚¬** |
| `@AssertTrue/False` | **μ΅°κ±΄μ μ°Έ/κ±°μ§“ κ²€μ‚¬** |

### d. μ ν¨μ„± κ²€μ‚¬μ— λ€ν• κ³ μ°°

To be Continue..